{% extends 'store/base.html' %}

{% block title %}{{ category.name }} - My Card{% endblock %}

{% block content %}

<!-- Category Header -->
{% if category %}
<div class="bg-gradient text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <nav aria-label="breadcrumb" class="mb-3">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-white-50">Home</a></li>
                        <li class="breadcrumb-item active text-white">{{ category.name }}</li>
                    </ol>
                </nav>
                <h1 class="display-5 mb-3">{{ category.name }}</h1>
                <p class="lead mb-0">{{ category.description }}</p>
            </div>
            <div class="col-lg-4 text-center">
                <i class="fas fa-box-open fa-5x opacity-25"></i>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="container my-5">
    <!-- Filter and Sort Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <h5 class="text-muted">{{ products|length }} Product{{ products|length|pluralize }} Found</h5>
        </div>
        <div class="col-md-6 text-md-end">
            <div class="dropdown">
                <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-sort me-2"></i>Sort By
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Price: Low to High</a></li>
                    <li><a class="dropdown-item" href="#">Price: High to Low</a></li>
                    <li><a class="dropdown-item" href="#">Name: A to Z</a></li>
                    <li><a class="dropdown-item" href="#">Newest First</a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Products Grid -->
    <div class="row">
        {% for product in products %}
        <div class="col-lg-4 col-md-6 mb-4 scroll-animate">
            <div class="card h-100 product-card">
                <div class="position-relative overflow-hidden">
                    <img src="{{ product.product_image.url }}" class="card-img-top" alt="{{ product.name }}" style="height: 250px; object-fit: cover;">
                    <div class="position-absolute top-0 end-0 m-3">
                        {% if product.original_price > product.selling_price %}
                            <span class="badge bg-danger">Sale</span>
                        {% endif %}
                        {% if product.quantity < 5 %}
                            <span class="badge bg-warning text-dark ms-1">Low Stock</span>
                        {% endif %}
                    </div>
                    <div class="product-overlay">
                        <a href="{% url 'product_view' product.category.slug product.slug %}" class="btn btn-light btn-sm">
                            <i class="fas fa-eye me-1"></i>Quick View
                        </a>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">
                        <a href="{% url 'product_view' product.category.slug product.slug %}" class="text-decoration-none">{{ product.name }}</a>
                    </h5>
                    <p class="text-muted small flex-grow-1">{{ product.small_description|truncatewords:12 }}</p>
                    <div class="mt-auto">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                {% if product.original_price > product.selling_price %}
                                    <span class="text-decoration-line-through text-muted small">₹{{ product.original_price }}</span><br>
                                {% endif %}
                                <span class="text-primary h5 mb-0">₹{{ product.selling_price }}</span>
                            </div>
                            <div class="text-end">
                                {% if product.quantity > 0 %}
                                    <small class="text-success"><i class="fas fa-check-circle"></i> In Stock</small>
                                {% else %}
                                    <small class="text-danger"><i class="fas fa-times-circle"></i> Out of Stock</small>
                                {% endif %}
                            </div>
                        </div>
                        <a href="{% url 'product_view' product.category.slug product.slug %}" class="btn btn-primary w-100">
                            <i class="fas fa-shopping-cart me-2"></i>View Details
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-search fa-5x text-muted opacity-50 mb-4"></i>
                <h3 class="text-gradient mb-3">No Products Found</h3>
                <p class="text-muted mb-4">{{ message|default:"No products available in this category at the moment." }}</p>
                <a href="{% url 'home' %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-arrow-left me-2"></i>Back to Home
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
.product-card {
    transition: var(--transition);
}

.product-card:hover {
    transform: translateY(-5px);
}

.product-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: var(--transition);
}

.product-card:hover .product-overlay {
    opacity: 1;
}
</style>

<script>
// Scroll animations
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animate');
        }
    });
}, observerOptions);

document.querySelectorAll('.scroll-animate').forEach(el => {
    observer.observe(el);
});
</script>

{% endblock %}